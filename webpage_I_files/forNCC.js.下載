define(['getNode'], function(getNode) {
    function main(env, opt, file) {
        
        //================================================================================================================================
        //根據 W3C：WAI-ARIA  麵包屑的容器請使用具有導航的角色（Navigation Landmark）
        //================================================================================================================================
        $('.list-text.breadcrumb .ct>.in').replaceWith(function(){return '<nav aria-selected="breadcrumb">' + $(this).html() + '</nav>';});
        // $('.list-text.breadcrumb .ct li:last-child a').removeAttr("href").replaceWith(function(){return '<div class="a" aria-current="page">' + $(this).html() + '</div>';});
        
        //================================================================================================================================
        // 修正無障礙 role button問題
        //================================================================================================================================
        $('.is-dot a,.list-pic.icon a,.list-text.open-data .ct a,.area-form.page-search .hd a,.list-text.user-tool .ct a,.base-header .epaper>.in>.ct>.in a,.list-text.share .hd a,.list-text.font-size .hd a,.search-area .hd a,a.div,.extend-nav a,.base-header .area-form.search .hd a,.list-text.jump-tool a,.social_media a,.base-footer>.in>.hd a,.simple-text.btn .ct a,.btn_email,.CCMS_SearchBtn,.btn_download,.btn_link,button,input:reset,input:submit,input:button').attr('role', 'button');
        $('.openinf a,.extend-links .hd a,.base-footer>.in>.hd a,.group-list.slider>.in>.ft a,.list-text.font-size .ct a,.list-text.user-tool .ct li a,.advanced a,.list-text.open-data .ct a,.list-text.jump-tool .ct li a,.more a').attr('role', 'button');        
        
        //================================================================================================================================
        //首頁
        //================================================================================================================================
        $("h2").each(function() {
            if ($(this).text().trim() === "") {
                $(this).remove(); 
            }
        });
        $("h3").each(function() {
            if ($(this).text().trim() === "") {
                $(this).remove(); 
            }
        });
        $("h4").each(function() {
            if ($(this).text().trim() === "") {
                $(this).remove(); 
            }
        });
        $(".page-caption-p a").each(function() {
            if ($(this).text().trim() === "") {
                $(this).remove(); 
            }
        });
        $("img[longdesc]").removeAttr("longdesc");
        if($(".area-customize.icons-g2")[0] != undefined){  
            $(".area-customize.icons-g2 .div .img img").attr("alt","");
        }
        if($(".list-pic.slider")[0] != undefined){  
            $(".list-pic.slider .ct img").attr("alt","");
        }
        

        $('img').each(function() {
            if($(this).attr('src').indexOf('transparent') > -1) {
              $(this).attr('alt', 'transparent');  
            }
          });
        $('area').each(function() {
            var title = $(this).attr('title');
            $(this).attr('alt', title);
          });
        //================================================================================================================================
        //首頁
        //================================================================================================================================
        //分享
        $('.base-footer .list-text.share .hd a').attr("href","javascript:void(0)").on("click", function() {
            $('.base-footer .list-text.share .ct').slideToggle();
        });
        $('.list-text.share .hd a').focus(function() {
            $('.search-tool').removeClass("is-active");
        });

        $('.list-text.font-size .ct a').focus(function() {
            $('.list-text.share').removeClass("is-active");
        });

        $(".area-form.page-search" ).removeClass("is-active");


        //拿掉未命名nav
        $('.for_accessibility>div').remove();

        //h2
        $('.block2 .hd .headH3').replaceWith(function(){
            return "<h2 class='headH3'>" + $(this).html() + "</h2>";
        });
        if (CCMS_LanguageSN == 1) {
            $('.block4 .hd .headH3').replaceWith(function(){
                return "<h2 class='headH3'>" + $(this).html() + "</h2>";
            });
            $('.block5 .hd .headH3').replaceWith(function(){
                return "<h2 class='headH3'>" + $(this).html() + "</h2>";
            });
        }

        //搜尋   
        //新增功能快截鍵  Accesskey_S alt + s
        $(".search-tool>.in>.hd a").attr({'href':'#Accesskey_S',"id":"Accesskey_S","accesskey":"S"});
        if (CCMS_LanguageSN == 1) {
            $('.area-form.search .ct .fieldset span.search input').attr("placeholder","請輸入關鍵字");
            $('<div>Alt+S：網站搜尋。</div>' ).appendTo( $( ".area-editor.system-info ul.sitemap" ) );
            $('<div>Alt+G：首頁滑動連結，此區塊連結跳至首頁內容錨點。</div>' ).appendTo( $( ".area-editor.system-info ul.sitemap" ) );
        }else {
            $('.area-form.search .ct .fieldset span.search input').attr("placeholder","Please Enter Keyword");
            $('<div>Alt+S：Search.</div>' ).appendTo( $( ".area-editor.system-info ul.sitemap" ) );
            $('<div>Alt+G：Slide link, this block link jumps to homepage content anchor.</div>' ).appendTo( $( ".area-editor.system-info ul.sitemap" ) );
        }
        //qrcode 拿掉無用的a
        $('.base-wrapper .list-pic.icon .ct li.qrcode a').removeAttr("href").replaceWith(function(){return "<div>" + $(this).html() + "</div>";});

        //================================================================================================================================
        //block2 重要議題
        //================================================================================================================================
        $(function() {
            var  $caption = $('.area-customize.news-card .ct .caption');
            if ($(window).width() < 600) {
                var maxHeight = 0;
                $caption.each(function() {
                    $(this).height('auto');
                    if (maxHeight < $(this).height()) { maxHeight = $(this).height() }
                });
                $caption.each(function() {
                    $(this).height(maxHeight);
                });
            }
            $(window).resize(function() {
                if ($(window).width() < 600) {
                    var maxHeight = 0;
                    $caption.each(function() {
                        $(this).height('auto');
                        if (maxHeight < $(this).height()) { maxHeight = $(this).height() }
                    });
                    $caption.each(function() {
                        $(this).height(maxHeight);
                    });
                }

            });
        });
        //================================================================================================================================
        //block4 免簽、落地簽、電子簽證資訊
        //================================================================================================================================
        //點擊元素以外任意地方隱藏該元素
        $(document).click(function(e){
            var target = $(e.target);
            if(target.closest(".country").length != 0) return;
            $('.block4 .visa .country .country_ul>li>a').find("span.show").stop().removeClass().addClass('hide');
        });
        $(function() {
            //六地區列表
            $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                $(this).find("span").stop().removeClass().addClass('show');
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            });
            $('.continents_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() {
                if ($(window).width() > 1025 ) {
                    $('.country_ul>li:nth-child(1)>[href="javascript:void(0)"]').focus();  //點地區 第一個國家被focus
                    $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                        $(".country_ul li>a>span.show").removeClass().addClass('hide');
                    });
                }
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                    $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                        $(".country_ul li>a>span.show").removeClass().addClass('hide');
                    });
                });
            });
            //國家列表

            //tab順序
            $(".tab1 .continents_ul li:nth-child(1)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2"); //目前位置
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(2)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 

            $(".tab1 .continents_ul li:nth-child(1)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(2)>a").attr("tabindex","3");
                }); 
            }); 

            $(".tab1 .continents_ul li:nth-child(2)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".tab1 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            });

            $(".tab1 .continents_ul li:nth-child(2)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
            }); 

            $(".tab1 .continents_ul li:nth-child(3)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".tab1 .continents_ul li:nth-child(4)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            });
            $(".tab1 .continents_ul li:nth-child(3)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(4)>a").attr("tabindex","3");
                }); 
            }); 


            $(".continents_ul li:nth-child(4)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".continents_ul li:nth-child(5)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab1 .continents_ul li:nth-child(4)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(5)>a").attr("tabindex","3");
                }); 
            }); 
            $(".tab2 .continents_ul li:nth-child(4)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab2 .continents_ul li:nth-child(5)>a").attr("tabindex","3");
                }); 
            }); 
            $(".tab3 .continents_ul li:nth-child(4)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab3 .continents_ul li:nth-child(5)>a").attr("tabindex","3");
                }); 
            }); 

            $(".continents_ul li:nth-child(5)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".continents_ul li:nth-child(6)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab1 .continents_ul li:nth-child(5)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab1 .continents_ul li:nth-child(6)>a").attr("tabindex","3");
                }); 
            }); 
            $(".tab2 .continents_ul li:nth-child(5)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab2 .continents_ul li:nth-child(6)>a").attr("tabindex","3");
                }); 
            }); 
            $(".tab3 .continents_ul li:nth-child(5)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab3 .continents_ul li:nth-child(6)>a").attr("tabindex","3");
                }); 
            });

            $(".tab1 .continents_ul li:nth-child(6)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".block4 .list-text.tab .ct ul li:nth-child(2) a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab1 .continents_ul li:nth-child(6)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".block4 .list-text.tab .ct ul li:nth-child(2) a").attr("tabindex","3");
                }); 
            }); 

            $(".tab2 .continents_ul li:nth-child(1)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(".block4 .list-text.tab .ct ul li a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".tab2 .continents_ul li:nth-child(2)>a").attr("tabindex","3");
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 


            $(".tab2 .continents_ul li:nth-child(2)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".tab2 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab2 .continents_ul li:nth-child(2)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab2 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
            }); 



            $(".tab2 .continents_ul li:nth-child(3)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".tab2 .continents_ul li:nth-child(4)>a").attr("tabindex","3");
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 



            $(".tab2 .continents_ul li:nth-child(6)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".block4 .list-text.tab .ct ul li:nth-child(3) a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab2 .continents_ul li:nth-child(6)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".block4 .list-text.tab .ct ul li:nth-child(3) a").attr("tabindex","3");
                }); 
            }); 


            //
            $(".tab3 .continents_ul li:nth-child(1)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(".block4 .list-text.tab .ct ul li a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".tab3 .continents_ul li:nth-child(2)>a").attr("tabindex","3");
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 


            $(".tab3 .continents_ul li:nth-child(2)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".tab3 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab3 .continents_ul li:nth-child(2)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".tab3 .continents_ul li:nth-child(3)>a").attr("tabindex","3");
                }); 
            }); 



            $(".tab3 .continents_ul li:nth-child(3)>a").on("focus", function() { //當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".tab3 .continents_ul li:nth-child(4)>a").attr("tabindex","3");
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 

            $(".tab3 .continents_ul li:nth-child(6)>a").on("focus", function() {//當 地區 被focus
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(this).attr("tabindex","2");
                $(".country_ul li:nth-child(1)>a").attr("tabindex","3")
                $(".country_ul li:nth-child(1)>a").focus(function(){ //當 第一國家 被focus
                    $(".continents_ul a,.country a").removeAttr("tabindex");
                }); 
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2");
                    $(".block4 .visa .ft ul li:nth-child(1)>span>a").attr("tabindex","3");
                }); 
                $('.country_ul>li>[href="javascript:void(0)"]').stop().on("touchstart click", function() { 
                    $(this).parents(".country_ul").find("span").removeClass().addClass('hide');
                    $(this).find("span").stop().removeClass().addClass('show');
                });
                $('.country_ul>li>[href="javascript:void(0)"]').focus(function(){
                    $(".country_ul li>a>span.show").removeClass().addClass('hide');
                });
            }); 
            $(".tab3 .continents_ul li:nth-child(6)>a").on("click", function() {
                $(".country_ul li:nth-last-child(1)>a").focus(function(){ ////當 最後國家 被focus
                    $(this).attr("tabindex","2"); //目前位置
                    $(".block4 .visa .ft ul li:nth-child(1)>span>a").attr("tabindex","3");
                }); 
            }); 


            $(".block4 .visa .ft ul li:nth-child(1) a").focus(function(){
                $(".continents_ul a,.country a").removeAttr("tabindex");
                $(".block4 .list-text.tab .ct ul li a").removeAttr("tabindex");
                $(this).removeAttr("tabindex");
                $(".country_ul li>a>span.show").removeClass().addClass('hide');
            });
        });
        //================================================================================================================================
        //block3 快捷服務 更多按鈕
        //================================================================================================================================
        $(".block3 .area-customize.icons-g2 .ct ul li:nth-child(1)").clone().appendTo(".block3 .area-customize.icons-g2 .ct ul").addClass("link_FastLink");

        if ($(window).width() < 927 ) {
            $(".block3 .area-customize.icons-g2 .ft").css("display","none");
            $(".link_FastLink").css("display","inline-block");
        }
        else {
            $(".block3 .area-customize.icons-g2 .ft").css("display","block");
            $(".link_FastLink").css("display","none");
        }
        $(window).resize(function() {
            if ($(window).width() < 927 ) {
                $(".block3 .area-customize.icons-g2 .ft").css("display","none");
                $(".link_FastLink").css("display","inline-block");
            }
            else {
                $(".block3 .area-customize.icons-g2 .ft").css("display","block");
                $(".link_FastLink").css("display","none");
            }
        });

        if (CCMS_LanguageSN == 1) {
            $(".link_FastLink .caption").text('更多 快捷服務');
            $(".link_FastLink a").attr("href","FastLink.aspx?n=796&sms=50").attr("title","更多 快捷服務").attr("target","_self");
        }else{
            $(".link_FastLink .caption:lang(en)").text('More Related Information');
            $(".link_FastLink a:lang(en)").attr("href","FastLink.aspx?n=1521&sms=282").attr("title","More Related Information").attr("target","_self");
        }

        //================================================================================================================================
        //block5 多媒體互動
        //================================================================================================================================
        //$('.block5 .area-essay.link .ct .essay').remove();//執行長意見 拿掉圖片裡的解說文字
        $('.block5 .area-customize.video .ct .video').replaceWith(function(){ //為了可以被focus div.video 變成 a.video
            return "<div class='video'>" + $(this).html() + "</div>";
        });
        // $( '<div style="font: 0/0 a;opacity: 0;">Test</div>' ).prependTo('.block5 .area-customize.video .ct .video');
        // $(".block5 .area-customize.video .ct .video > div").text($('.block5 .area-customize.video .ct .video iframe').attr("title"));


        $('.block5 .area-customize.video .ct .video').hover(function(){
            $(this).addClass('is-active');
        },function(){
            $(this).addClass('is-active');
        });
        //block5 多媒體互動 IG照片
        if (CCMS_LanguageSN == 1) {
            $('<span>[另開新視窗]</span>' ).appendTo( $( ".block5 .area-essay.link .ct .div>.essay>.caption" ) );
        }else{
            $('<span>[Open a new window]</span>' ).appendTo( $( ".block5 .area-essay.link .ct .div>.essay>.caption" ) );
        }
        $('.block5 .area-essay.link a').hover(
            function() {
                $(this).parents("li").addClass("hover");
            }, function() {
                $(this).parents("li").removeClass();
            }
        );
        $('.block5 .area-essay.link a').focus(function(){
            $(this).parents("li").addClass("hover");
        });
        $('.block5 .area-essay.link a').blur(function(){
            $(this).parents("li").removeClass();
        });

        //block5 多媒體互動 更多按鈕
        if ($(window).width() < 1020) {
            $(".block5 .group-list.slider .ft").css("display","none");
            $(".link_ig").css("display","block");
        }
        else {
            $(".block5 .group-list.slider .ft").css("display","block");
            $(".link_ig").css("display","none");
        }
        $(window).resize(function() {
            if ($(window).width() < 1020) {
                $(".block5 .group-list.slider .ft").css("display","none");
                $(".link_ig").css("display","block");
            }
            else {
                $(".block5 .group-list.slider .ft").css("display","block");
                $(".link_ig").css("display","none");
            }
        });
        $(".block5 .group-list.link ul li:nth-child(5)").clone().appendTo(".block5 .group-list.link ul").addClass("link_ig");
        $(".link_ig .caption span").text('更多 IG美照')
        $(".link_ig a").attr("href","https://www.instagram.com/mofa_taiwan/").attr("title","[另開新視窗]外交部instagram");
        $(".link_ig .caption span:lang(en)").text('more photo')
        $(".link_ig a:lang(en)").attr("href","https://www.instagram.com/mofa_taiwan/").attr("title","[Open New Window]instagram");
        $("a:has(iframe)").each(function() {
            var iframe = $(this).find("iframe"); 
            var iframeTitle = iframe.attr("title");
            
            $(this).attr("title", iframeTitle);
        });
        //================================================================================================================================
        //內頁
        //================================================================================================================================
        $('#ContentPlaceHolder1_ContenDiv > h4').remove();//重要議題
        
        $(function() {
            //focusContent BUG 
            if ($('.page-search')[0]) { 
                //物件存在的處理邏輯 
                $('.page-header .msg-tool .simple-text.accesskey .ct a').on('click', function () {
                    $('#CCMS_Content').find('input:eq(0)').focus();
                });
                
            } else {
            //物件不存在的處理邏輯 
            }
            if ($('.area-editor.user-edit')[0]) { 
                //物件存在的處理邏輯 
                $('.page-header .msg-tool .simple-text.accesskey .ct a').on('click', function () {
                    $('.area-editor.user-edit a:eq(0)').focus();
                });
            }


            var Cts3 = "法規命令及條約協定"; 
            if(Cts3.indexOf("法規命令及條約協定") >= 0 ) { 
                $('.page-header .msg-tool .simple-text.accesskey .ct a').on('click', function () {
                    $('.list-text.file-download .ct a:eq(0)').focus();
                });
            }
            var Cts4 = "Third Report on the ICCPR and ICESCR"; 
            if(Cts4.indexOf("Third Report on the ICCPR and ICESCR") >= 0 ) { 
                $('.page-header .msg-tool .simple-text.accesskey .ct a').on('click', function () {
                    $('.list-text.file-download-multiple .ct a:eq(0)').focus();
                });
            }
        });

        //超連結當含有字串和圖片 兩者存在時 圖片alt為空
        $('.area-customize.pchouse-album04 ul li .img img,.block3 .area-customize.icons-g2 .ct .img img').attr("alt","");

        //國家與地區 CountryAreaInfo.aspx?casn=5&n=5&sms=33
        $('#ContentPlaceHolder1_dlindex .countryinf>a .flagbox img').wrap('<span></span>');//國旗外面包span     display: flex; align-items: center; justify-content: center;
        $('.pointicon img,.flagbox img').attr("alt","").removeAttr("title");//icon

        //回最上面
        $('.base-footer .simple-text.btn .ct a').attr("href","#Accesskey_U").on("touchstart click", function() {
            $('#Accesskey_U').focus();
        });

        //為民服務>參訪申請 NavigationMinistry.aspx?n=106&sms=89 參訪本部
        // $(".data_midlle_Schedule_box .application_form_list").find('li:nth-child(2)>div,li:nth-child(3)>div,li:nth-child(5)>div').not('.form_title').wrapAll('<div class="form_div"></div>');
        $('.MT_captcha input[type="button"]').wrapAll('<div class="MT_captcha_div"></div>');

        //分辨 相關圖片 還是 相關影片 News_Content.aspx
        $(".list-pic.pic-download").find('a[href$=".GIF"], a[href$=".JPG"], a[href$=".JPGE"], a[href$=".PNG"], a[href$=".BMP"], a[href$=".gif"], a[href$=".jpg"], a[href$=".jpg"], a[href$=".png"], a[href$=".bmp"]').parents(".list-pic.pic-download").find('.hd').addClass("is-img");

        //組織與職掌 改 舊有網頁 Organization.aspx?n=60&sms=85
        $('a#onTab1').replaceWith(function(){
            return "<span class='onTab1'>" + $(this).html() + "</span>";
        });
        $('a#onTab2').replaceWith(function(){
            return "<span class='onTab2'>" + $(this).html() + "</span>";
        });
        $('a.a1').replaceWith(function(){
            return "<span class='a1'>" + $(this).html() + "</span>";
        });
        $('a.a2').replaceWith(function(){
            return "<span class='a2'>" + $(this).html() + "</span>";
        });

        //組織與職掌 Organization.aspx?n=60&sms=85
        $(function() {
            var maxHeight = 0;
            $('.organize .groups a.button').each(function() {
                $(this).height('auto');
                if (maxHeight < $(this).height()) { maxHeight = $(this).height() }
            });
            $('.organize .groups a.button').each(function() {
                $(this).height(maxHeight);
            });
            $(window).resize(function() {
                var maxHeight = 0;
                $('.organize .groups a.button').each(function() {
                    $(this).height('auto');
                    if (maxHeight < $(this).height()) { maxHeight = $(this).height() }
                });
                $('.organize .groups a.button').each(function() {
                    $(this).height(maxHeight);
                });
            });
        });

        //================================================================================================================================
        //ckeditor
        //================================================================================================================================
        // ckeditor 裡面有 <h1> 就把它變成 <div class="h1"> 
        for ( i=0; i < 7; i++){
            $('.page-caption-p h'+ i).replaceWith(function(){
                return '<span class=h'+ i + '>' + $(this).html() + "</span>";
            });
            $('.area-editor.user-edit h'+ i).replaceWith(function(){
                return '<span class=h'+ i + '>' + $(this).html() + "</span>";
            });
        }


        // ckeditor 裡面有 title meta tabindex 就移除
        $('.page-caption-p,.area-editor.user-edit').find('title,meta').remove().end().find('td,th').removeAttr("tabindex");
    
        // ckeditor 裡面有 <pre> 就把它變成 <p> 
        $('.page-caption-p pre, .area-editor.user-edit pre').replaceWith(function(){
            return "<p>" + $(this).html() + "</p>";
        });

        // ckeditor 裡面有 <u> 就把它變成 <strong> 
        $('.page-caption-p u, .area-editor.user-edit u').replaceWith(function(){
            return "<strong>" + $(this).html() + "</strong>";
        });

        //================================================================================================================================
        //fatfooter等高
        //================================================================================================================================
        $('.base-footer .group-list.nav>.in>.ct>.in>ul>li').addClass(function(index) {
            return 'sameHeight' + (Math.floor(index / 2) + 1);  
          });
          
          var resizeHandlers = [];
          
          for (var i = 1; i <= 4; i++) {
            (function(i) {
              var maxHeight = 0;
              var $items = $('.sameHeight' + i);
              
              function resize() {
                $items.height('auto');
                maxHeight = Math.max.apply(null, $items.map(function() {
                  return $(this).height();  
                }).get());            
                $items.height(maxHeight);
              }
              
              resizeHandlers.push(resize);
              
              resize();
            })(i);  
          }
          
          $(window).resize(function() {
            for (var i = 0; i < resizeHandlers.length; i++) {
              resizeHandlers[i]();  
            }
          });
        //================================================================================================================================
        //移除<style>使用絕對單位的字級樣式
        //================================================================================================================================
        $('style').each(function () {
            if ($(this).innerText != '') {
                var styleText = $(this).text();
                var newStyleText = styleText.replace(/font-size:\s*(\d+)\s*px;/g, function (match, p1) {
                    // 將 px 單位轉換為 em（這裡只是一個簡單的轉換，實際應用中可能需要更複雜的邏輯）
                    var pxValue = parseInt(p1);
                    var emValue = pxValue / 16.0; // 16px 為一個 em 的標準值

                    return 'font-size: ' + emValue + 'em;';
                });
                $(this).text(newStyleText);
            }
        });
        //================================================================================================================================
        //移除行內使用絕對單位的字級樣式
        //================================================================================================================================
		function ReplaceFS (t) {
            if ($(t).length > 0) {
                var $tag = $(t);
                for (i = 0; i < $tag.length; i++) {
                    if ($tag.eq(i).attr('style') != undefined){
                        var repxB = new RegExp('FONT-SIZE:[^;\']*px(;)?','g');
                        var reptB = new RegExp('FONT-SIZE:[^;\']*pt(;)?','g');
                        var repx = new RegExp('font-size:[^;\']*px(;)?','g');
                        var rept = new RegExp('font-size:[^;\']*pt(;)?','g');
                        var $style = $tag.eq(i).attr('style');
                        $style = $style.replace(repxB, '').replace(reptB, '').replace(repx, '').replace(rept, '');
                        $tag.eq(i).attr('style', $style);
                    }
                }
            }
        }
            
        ReplaceFS('strong');ReplaceFS('span');ReplaceFS('br');ReplaceFS('h3');ReplaceFS('h4');ReplaceFS('h5');ReplaceFS('h6');ReplaceFS('img');ReplaceFS('section');ReplaceFS('div');ReplaceFS('a');ReplaceFS('font');ReplaceFS('b');ReplaceFS('table');ReplaceFS('th');ReplaceFS('td');ReplaceFS('tr');ReplaceFS('hr');ReplaceFS('ol');ReplaceFS('ul');ReplaceFS('li');ReplaceFS('p');ReplaceFS('i');ReplaceFS('hr');ReplaceFS('blockquote');ReplaceFS('pre');
    }
    
    return main;
});
